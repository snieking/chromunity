import {User} from "../types";
import * as BoomerangCache from "boomerang-cache";
import {getCurrentRepresentativePeriod, getRepresentatives} from "../blockchain/RepresentativesService";

const LOCAL_CACHE = BoomerangCache.create('local-bucket', {storage: 'local', encrypt: true});
const SESSION_CACHE = BoomerangCache.create('session-bucket', {storage: 'session', encrypt: true});

const USER_KEY = "user";
const MNEMONIC_KEY = "mnemonic";
const REPRESENTATIVE_KEY = "representative";

export function setMnemonic(mnemonic: string): void {
    LOCAL_CACHE.set(MNEMONIC_KEY, mnemonic);
}

export function getMnemonic(): string {
    return LOCAL_CACHE.get(MNEMONIC_KEY, "");
}

export function setUser(user: User): void {
    SESSION_CACHE.set(USER_KEY, user);
}

export function getUser(): User {
    return SESSION_CACHE.get(USER_KEY, {});
}

export function godAlias(): string {
    return "admin";
}

export function isGod(): boolean {
    return getUser().name === godAlias();
}

export function setRepresentative(isRepresentative: boolean): void {
    SESSION_CACHE.set(REPRESENTATIVE_KEY, isRepresentative, 600);
}

/**
 * Checks whether or not the user is a representative and caches that response.
 */
export function isRepresentative(): Promise<boolean> {
    const isRepresentative: boolean = SESSION_CACHE.get(REPRESENTATIVE_KEY);

    if (isRepresentative != null) {
        return new Promise<boolean>(resolve => resolve(isRepresentative));
    }

    return getCurrentRepresentativePeriod()
        .then(election => getRepresentatives(election.id))
        .then((representatives: string[]) => representatives.includes(getUser().name))
        .then((isRepresentative: boolean) => {
            setRepresentative(isRepresentative);
            return isRepresentative;
        }).catch(() => {
            setRepresentative(false);
            return false;
        });
}

export function ifEmptyAvatarThenPlaceholder(avatar: string) {
    return (avatar !== "" && avatar != null) ? avatar : "data:image/png;base64,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";
}
